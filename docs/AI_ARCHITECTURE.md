# AI í™œìš© ì•„í‚¤í…ì²˜

## ğŸ¯ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” **í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ AI ëŒ€í™” ì‹œìŠ¤í…œ**ìœ¼ë¡œ, ì‹¬ë¦¬ í”„ë¡œí•„(MBTI + DiSC + ì• ë‹ˆì–´ê·¸ë¨)ê³¼ ê´€ê³„(ìƒê¸‰ì/ë™ë£Œ/í•˜ê¸‰ì)ë¥¼ ë°˜ì˜í•œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ— AI ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
ì‚¬ìš©ì ë©”ì‹œì§€
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ì„ë² ë”© ìƒì„± (OpenAI)                â”‚
â”‚  text-embedding-3-small (1536d)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ë²¡í„° ê²€ìƒ‰ (pgvector)                â”‚
â”‚  - ìœ ì‚¬ ëŒ€í™” íŒ¨í„´ ê²€ìƒ‰                   â”‚
â”‚  - MBTI + ê´€ê³„ í•„í„°ë§                   â”‚
â”‚  - ì½”ì‚¬ì¸ ìœ ì‚¬ë„ > 0.3                  â”‚
â”‚  - ìƒìœ„ 3ê°œ íŒ¨í„´ ì„ íƒ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ êµ¬ì„±                 â”‚
â”‚  - í˜ë¥´ì†Œë‚˜ íŠ¹ì„± (MBTI+DiSC+ì—ë‹ˆì–´ê·¸ë¨)  â”‚
â”‚  - ê´€ê³„ë³„ ê°€ì´ë“œ (ì¡´ëŒ“ë§/ë°˜ë§)          â”‚
â”‚  - ìœ ì‚¬ íŒ¨í„´ ì»¨í…ìŠ¤íŠ¸                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ëŒ€í™” ìƒì„± (GPT-4o)                  â”‚
â”‚  - ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ                        â”‚
â”‚  - í˜ë¥´ì†Œë‚˜ ì¼ê´€ì„± ìœ ì§€                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
         AI ì‘ë‹µ
```

---

## ğŸ¤– ì£¼ìš” AI ì»´í¬ë„ŒíŠ¸

### 1. ì„ë² ë”© ì‹œìŠ¤í…œ

**ê¸°ìˆ **: OpenAI `text-embedding-3-small` (1536ì°¨ì›)

**ì„ë² ë”© ëŒ€ìƒ**:
- ì‚¬ìš©ì ë©”ì‹œì§€ (ì‹¤ì‹œê°„)
- ëŒ€í™” íŒ¨í„´ (ì‚¬ì „ ìƒì„±)
- í˜ë¥´ì†Œë‚˜ í”„ë¡œí•„ (ìƒì„± ì‹œ)

**ì½”ë“œ**: `lib/embeddings.ts`

```typescript
export async function generateEmbedding(text: string): Promise<number[]> {
  const { embedding } = await embed({
    model: openai.embedding('text-embedding-3-small'),
    value: text,
  })
  return embedding
}
```

---

### 2. ë²¡í„° ê²€ìƒ‰ (RAG)

**ê¸°ìˆ **: PostgreSQL pgvector + IVFFlat ì¸ë±ìŠ¤

**ê²€ìƒ‰ íŒŒë¼ë¯¸í„°**:
- `query_embedding`: ì‚¬ìš©ì ë©”ì‹œì§€ ì„ë² ë”©
- `mbti_filter`: í˜ë¥´ì†Œë‚˜ MBTI (ì˜ˆ: "INTJ")
- `relationship_filter`: ê´€ê³„ íƒ€ì… (superior/peer/subordinate)
- `enneagram_filter`: ì• ë‹ˆì–´ê·¸ë¨ íƒ€ì… (ì˜ˆ: "5")
- `match_threshold`: 0.3 (30% ì´ìƒ ìœ ì‚¬ë„)
- `match_count`: 3 (ìƒìœ„ 3ê°œ)

**PostgreSQL í•¨ìˆ˜**:

```sql
CREATE FUNCTION search_similar_patterns(
  query_embedding TEXT,  -- JSON.stringify(number[])
  match_threshold FLOAT DEFAULT 0.3,
  match_count INT DEFAULT 3,
  mbti_filter VARCHAR(4) DEFAULT NULL,
  relationship_filter VARCHAR(50) DEFAULT NULL,
  enneagram_filter VARCHAR(3) DEFAULT NULL
)
RETURNS TABLE (
  id UUID,
  similarity FLOAT,
  pattern_text TEXT,
  relationship_type VARCHAR(50),
  mbti VARCHAR(4),
  disc VARCHAR(4),
  enneagram VARCHAR(3),
  pattern_category VARCHAR(100)
);
```

**ê²€ìƒ‰ ê³¼ì •**:
1. ì‚¬ìš©ì ë©”ì‹œì§€ â†’ ì„ë² ë”© ìƒì„±
2. í˜ë¥´ì†Œë‚˜ MBTI + ê´€ê³„ íƒ€ì… + ì• ë‹ˆì–´ê·¸ë¨ìœ¼ë¡œ í•„í„°ë§
3. ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚° (pgvector)
4. threshold ì´ìƒì¸ íŒ¨í„´ë§Œ ì„ íƒ
5. ìœ ì‚¬ë„ ìˆœìœ¼ë¡œ ì •ë ¬ â†’ ìƒìœ„ 3ê°œ ë°˜í™˜

---

### 3. í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§

**êµ¬ì¡°**:

```
[ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸]

ë‹¹ì‹ ì€ [í˜ë¥´ì†Œë‚˜ëª…]ì…ë‹ˆë‹¤.

## ì‹¬ë¦¬ í”„ë¡œí•„
- MBTI: [INTJ] - ì „ëµì , ë…ë¦½ì , ë…¼ë¦¬ì 
- DiSC: [DC] - ì£¼ë„ì ì´ê³  ì‹ ì¤‘í•¨
- ì• ë‹ˆì–´ê·¸ë¨: [5w6] - íƒêµ¬ì, ì§€ì‹ ì¶”êµ¬
- í•µì‹¬ íŠ¹ì„±: [ë¶„ì„ì , ë…ë¦½ì , ì „ëµì , ì§€ì‹ ì¶”êµ¬]

## ëŒ€í™” ìƒëŒ€ì™€ì˜ ê´€ê³„
- ê´€ê³„: ë¶€í•˜ ì§ì› (ë‹¹ì‹ ì´ ìƒê¸‰ì)
- ì–´ì¡°: ì •ì¤‘í•˜ë˜ ì§€ì‹œì 
- ì¡´ëŒ“ë§ ì‚¬ìš©

## ëŒ€í™” ìŠ¤íƒ€ì¼
- ì˜ì‚¬ì†Œí†µ: ë…¼ë¦¬ì ì´ê³  ì²´ê³„ì  (INTJ + DC)
- ì˜ì‚¬ê²°ì •: ë°ì´í„° ê¸°ë°˜, ì „ëµì  (INTJ + 5w6)
- ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì‘: ë¬¸ì œ ë¶„ì„ ë° ì†”ë£¨ì…˜ ì œì‹œ

## ì°¸ê³ í•  ëŒ€í™” íŒ¨í„´ (ë²¡í„° ê²€ìƒ‰ ê²°ê³¼)
1. [íŒ¨í„´ 1 í…ìŠ¤íŠ¸] (ìœ ì‚¬ë„: 45%)
2. [íŒ¨í„´ 2 í…ìŠ¤íŠ¸] (ìœ ì‚¬ë„: 38%)
3. [íŒ¨í„´ 3 í…ìŠ¤íŠ¸] (ìœ ì‚¬ë„: 35%)

## ì¤‘ìš” ì§€ì¹¨
1. ìœ„ ì‹¬ë¦¬ í”„ë¡œí•„ì— ì¼ê´€ë˜ê²Œ ëŒ€í™”í•˜ì„¸ìš”
2. ì• ë‹ˆì–´ê·¸ë¨ í•µì‹¬ ë™ê¸°ë¥¼ ë°˜ì˜í•˜ì„¸ìš”
3. ê´€ê³„ì— ë§ëŠ” ì–´ì¡°ë¥¼ ìœ ì§€í•˜ì„¸ìš”
4. ìì—°ìŠ¤ëŸ½ê³  ì¸ê°„ì ì¸ ëŒ€í™”ë¥¼ í•˜ì„¸ìš”

[ëŒ€í™” íˆìŠ¤í† ë¦¬]
User: ...
Assistant: ...
```

**ì½”ë“œ**: `app/api/chat/route.ts`

```typescript
const systemPrompt = buildSystemPrompt(
  persona,
  relationshipType,
  similarPatterns
)

const stream = await streamText({
  model: openai('gpt-4o'),
  system: systemPrompt,
  messages: conversationHistory,
})
```

---

### 4. ëŒ€í™” ìƒì„± (LLM)

**ëª¨ë¸**: OpenAI GPT-4o

**íŠ¹ì§•**:
- ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (í† í° ë‹¨ìœ„)
- í˜ë¥´ì†Œë‚˜ ì¼ê´€ì„± ìœ ì§€
- ì»¨í…ìŠ¤íŠ¸ ì´í•´ (ëŒ€í™” íˆìŠ¤í† ë¦¬)

**Vercel AI SDK í™œìš©**:

```typescript
import { streamText } from 'ai'
import { openai } from '@ai-sdk/openai'

export async function POST(req: Request) {
  const { messages, personaId, relationshipType } = await req.json()

  // 1. í˜ë¥´ì†Œë‚˜ ë¡œë“œ
  const persona = await loadPersona(personaId)

  // 2. ë²¡í„° ê²€ìƒ‰
  const patterns = await searchSimilarPatterns(...)

  // 3. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
  const systemPrompt = buildSystemPrompt(persona, relationshipType, patterns)

  // 4. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
  const stream = await streamText({
    model: openai('gpt-4o'),
    system: systemPrompt,
    messages,
  })

  return stream.toDataStreamResponse()
}
```

---

## ğŸ“Š ê³¨ë“  ë°ì´í„°ì…‹ ì „ëµ

### í˜„ì¬ ìƒíƒœ
- **ê³¨ë“  íŒ¨í„´ ìˆ˜**: 123ê°œ
- **MBTI ì»¤ë²„ë¦¬ì§€**: 16ê°œ ì „ì²´ (í‰ê·  7.7ê°œ/MBTI)
- **ê´€ê³„ íƒ€ì… ë¶„í¬**:
  - peer: 68ê°œ (55.3%)
  - subordinate: 31ê°œ (25.2%)
  - superior: 24ê°œ (19.5%)

### íŒ¨í„´ êµ¬ì¡°

```typescript
interface ConversationPattern {
  mbti: string              // "INTJ"
  disc: string              // "DC" (16ê°€ì§€ ì¡°í•© ì‚¬ìš©)
  enneagram: string         // "5" (ê¸°ë³¸ íƒ€ì…)
  relationship_type: string // "superior" | "peer" | "subordinate"
  pattern_category: string  // "feedback", "support", "conflict" ë“±
  conversation_topic: string
  emotional_context: string
  pattern_text: string      // í•µì‹¬ íŒ¨í„´ ì„¤ëª…
  example_responses: string[] // ì˜ˆì‹œ ì‘ë‹µ 3-5ê°œ
  effectiveness_score: number // 0.82~0.92
  pattern_embedding: number[] // 1536ì°¨ì› ë²¡í„°
}
```

### íŒ¨í„´ ìƒì„± í”„ë¡œì„¸ìŠ¤

```
1. ìš°ì„ ìˆœìœ„ ì¡°í•© ì„ ì •
   â†“
2. ê° ì¡°í•©ë³„ ìƒí™© ì •ì˜
   - feedback, support, conflict, decision_making ë“±
   â†“
3. íŒ¨í„´ í…ìŠ¤íŠ¸ ì‘ì„±
   - MBTI + DiSC + ì• ë‹ˆì–´ê·¸ë¨ íŠ¹ì„± ë°˜ì˜
   - ê´€ê³„ë³„ ì–´ì¡° ê³ ë ¤
   â†“
4. ì„ë² ë”© ìƒì„±
   - OpenAI text-embedding-3-small
   â†“
5. DB ì €ì¥
   - conversation_patterns í…Œì´ë¸”
   - pattern_embedding ì»¬ëŸ¼ (vector)
```

**ì‹œë”© ìŠ¤í¬ë¦½íŠ¸**: `project/scripts/seed-golden-patterns.ts`

---

## ğŸ” ê²€ìƒ‰ í’ˆì§ˆ ìµœì í™”

### Threshold ì¡°ì •

**ì´ˆê¸° ì„¤ì •**: 0.7 (70% ìœ ì‚¬ë„)
**ë¬¸ì œ**: ì‹¤ì œ ì‚¬ìš©ì ì¿¼ë¦¬ëŠ” 30-41% ìˆ˜ì¤€
**ìµœì í™”**: 0.3 (30% ìœ ì‚¬ë„)

**ê·¼ê±°**:
- ì‚¬ìš©ì ë©”ì‹œì§€ëŠ” ì§§ê³  êµ¬ì–´ì²´
- ê³¨ë“  íŒ¨í„´ì€ ìƒì„¸í•˜ê³  ê³µì‹ì 
- ì˜ë¯¸ì  ìœ ì‚¬ë„ê°€ ë†’ì•„ë„ í‘œí˜„ ë°©ì‹ ì°¨ì´ ì¡´ì¬

### ì• ë‹ˆì–´ê·¸ë¨ í•„í„°ë§

**ë¬¸ì œ**: Wing ì •ë³´ (`5w6`) vs ê¸°ë³¸ íƒ€ì… (`5`)

**í•´ê²°**:
```typescript
// Wing ì œê±°í•˜ì—¬ ê¸°ë³¸ íƒ€ì…ìœ¼ë¡œ ë³€í™˜
const enneagramBase = persona.enneagram.split('w')[0] // "5w6" â†’ "5"
```

### ê²°ê³¼ ê°œìˆ˜ ìµœì í™”

**ì´ˆê¸°**: 5ê°œ
**ìµœì í™”**: 3ê°œ

**ê·¼ê±°**:
- í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ìµœì í™”
- GPT-4o ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° íš¨ìœ¨ì„±
- í’ˆì§ˆ vs ì–‘ íŠ¸ë ˆì´ë“œì˜¤í”„

---

## ğŸ’¾ ë°ì´í„° íë¦„

### ëŒ€í™” ì„¸ì…˜ ìƒì„±

```typescript
// 1. ì„¸ì…˜ ìƒì„±
const session = await supabase
  .from('chat_sessions')
  .insert({
    user_id,
    persona_profile_id,
    relationship_type: 'superior',
  })

// 2. ë©”ì‹œì§€ ì €ì¥
await supabase.from('chat_messages').insert([
  { session_id, role: 'user', content: userMessage },
  { session_id, role: 'assistant', content: aiResponse },
])
```

### ë©”ì‹œì§€ ì €ì¥ ì „ëµ

**ë¬¸ì œ**: React í´ë¡œì €ë¡œ ì¸í•œ stale state
**í•´ê²°**: `useRef` ì‚¬ìš©

```typescript
const sessionIdRef = useRef<string | null>(null)

const handleSaveMessage = async (message: Message) => {
  const currentSessionId = sessionIdRef.current

  if (!currentSessionId) {
    const newSession = await createChatSession(...)
    sessionIdRef.current = newSession.id
  }

  await saveChatMessage(sessionIdRef.current, message)
}
```

---

## ğŸ“ˆ ì„±ëŠ¥ íŠ¹ì„±

### ì‘ë‹µ ì‹œê°„

| ë‹¨ê³„ | ì‹œê°„ | ìµœì í™” |
|-----|------|--------|
| **ì„ë² ë”© ìƒì„±** | ~200ms | OpenAI API |
| **ë²¡í„° ê²€ìƒ‰** | ~50ms | IVFFlat ì¸ë±ìŠ¤ |
| **GPT-4o ì²« í† í°** | ~500ms | Edge Runtime |
| **ì „ì²´ ì‘ë‹µ** | ~3-5s | ìŠ¤íŠ¸ë¦¬ë° |

### ë²¡í„° ì¸ë±ìŠ¤

```sql
CREATE INDEX idx_pattern_embedding
ON conversation_patterns
USING ivfflat (pattern_embedding vector_cosine_ops)
WITH (lists = 100);
```

- ì„ í˜• ê²€ìƒ‰ ëŒ€ë¹„ 10ë°° ë¹ ë¦„
- 10,000 rowsê¹Œì§€ ìµœì í™”
- ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ì—°ì‚°ì ì‚¬ìš©

---

## ğŸ”® í–¥í›„ ê°œì„  ì‚¬í•­

### Phase 8: í’ˆì§ˆ í–¥ìƒ

1. **íŒ¨í„´ ì‚¬ìš© ëª¨ë‹ˆí„°ë§**
   - íŒ¨í„´ë³„ ì‚¬ìš© ë¹ˆë„ ì¶”ì 
   - íš¨ê³¼ì„± ì ìˆ˜ ì—…ë°ì´íŠ¸
   - ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” íŒ¨í„´ ì‹ë³„

2. **ìë™ íŒ¨í„´ ìƒì„±**
   - GPT-4o ê¸°ë°˜ íŒ¨í„´ ìƒì„±
   - ëˆ„ë½ëœ ì¡°í•© ìë™ íƒì§€
   - í’ˆì§ˆ ê²€ì¦ ë¡œì§

3. **ê³„ì¸µì  í´ë°±** (ì„ íƒ)
   - Level 1: MBTI + DiSC + ì• ë‹ˆì–´ê·¸ë¨ + ê´€ê³„
   - Level 2: MBTI + ê´€ê³„
   - Level 3: ê´€ê³„ë§Œ
   - Level 4: ì¼ë°˜ íŒ¨í„´

4. **Re-ranking**
   - ë²¡í„° ìœ ì‚¬ë„ Ã— 0.7
   - effectiveness_score Ã— 0.2
   - ì‚¬ìš© ë¹ˆë„ Ã— 0.1

---

## ğŸ”— ê´€ë ¨ íŒŒì¼

**AI ë¡œì§**
- [lib/embeddings.ts](../lib/embeddings.ts) - ì„ë² ë”© ìƒì„±
- [lib/supabase/vector.ts](../lib/supabase/vector.ts) - ë²¡í„° ê²€ìƒ‰
- [app/api/chat/route.ts](../app/api/chat/route.ts) - ëŒ€í™” API

**ë°ì´í„°**
- [project/data/psychology-profiles.json](../project/data/psychology-profiles.json) - ì‹¬ë¦¬ í”„ë¡œí•„ ì •ì˜
- [project/scripts/seed-golden-patterns.ts](../project/scripts/seed-golden-patterns.ts) - ê³¨ë“  íŒ¨í„´ ì‹œë”©

**ë¬¸ì„œ**
- [docs/ARCHITECTURE.md](ARCHITECTURE.md) - ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
- [docs/ai-pattern-generation.md](ai-pattern-generation.md) - íŒ¨í„´ ìƒì„± ìƒì„¸ ê°€ì´ë“œ

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-14
