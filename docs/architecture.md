# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ— ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client (Next.js 16)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Auth Flow    â”‚  â”‚ Chat UI      â”‚  â”‚ Persona Mgmt â”‚      â”‚
â”‚  â”‚ (Supabase)   â”‚  â”‚ (shadcn/ui)  â”‚  â”‚ (CRUD)       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel Edge/Serverless                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Auth API     â”‚  â”‚ Chat API     â”‚  â”‚ Persona API  â”‚      â”‚
â”‚  â”‚              â”‚  â”‚ (Streaming)  â”‚  â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Supabase (Backend)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Auth         â”‚  â”‚ PostgreSQL   â”‚  â”‚ Realtime     â”‚      â”‚
â”‚  â”‚ (Social)     â”‚  â”‚ + pgvector   â”‚  â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                      â”‚
          â–¼                                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ OpenAI   â”‚                          â”‚ Vector   â”‚
    â”‚ GPT-4o   â”‚                          â”‚ Search   â”‚
    â”‚ Embeddingâ”‚                          â”‚ (cosine) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ í•µì‹¬ ë°ì´í„° íë¦„

### 1. ì¸ì¦ íë¦„
```
User â†’ Social Provider (Google/GitHub/Discord)
     â†’ Supabase Auth (JWT ë°œê¸‰)
     â†’ Profile Creation (profiles í…Œì´ë¸”)
     â†’ Dashboard Redirect
```

**íŠ¹ì§•**:
- ì†Œì…œ ë¡œê·¸ì¸ë§Œ ì§€ì› (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì œì™¸)
- Supabase Authë¡œ ì„¸ì…˜ ìë™ ê´€ë¦¬
- RLSë¡œ ìë™ ê¶Œí•œ ì œì–´

### 2. í˜ë¥´ì†Œë‚˜ ìƒì„± íë¦„
```
User Input
  â”œâ”€ MBTI ì„ íƒ (í•„ìˆ˜)
  â”œâ”€ DiSC ì„ íƒ (í•„ìˆ˜ - 16 í‘œì¤€ ìœ í˜•, ëª¨ë‘ ëŒ€ë¬¸ì)
  â””â”€ ì• ë‹ˆì–´ê·¸ë¨ ì„ íƒ (í•„ìˆ˜)
       â†“
Traits Combination
  â”œâ”€ MBTI â†’ ì¸ì§€ ê¸°ëŠ¥ íŠ¹ì„±
  â”œâ”€ DiSC â†’ í–‰ë™ ìŠ¤íƒ€ì¼ íŠ¹ì„± (D, I, S, C + 12 ì¡°í•©)
  â””â”€ ì• ë‹ˆì–´ê·¸ë¨ â†’ í•µì‹¬ ë™ê¸°
       â†“
Profile Text Generation
  "ISTJ + CS + 1w2ëŠ” ì²´ê³„ì ì´ê³  ì‹ ì¤‘í•œ ì™„ë²½ì£¼ì˜ì..."
       â†“
Vercel AI SDK embed() - text-embedding-3-small (1536d)
  [0.123, -0.456, 0.789, ...]
       â†“
Supabase Edge Function (Database Trigger ë°©ì‹)
  - INSERT/UPDATE ê°ì§€
  - Vercel AI SDKë¡œ embedding ìƒì„±
  - profile_embedding ìë™ ì €ì¥
       â†“
Store in persona_profiles
  - profile_embedding vector(1536)
  - traits JSONB
```

### 3. ëŒ€í™” íë¦„ (ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°)
```
User Message
  "í”„ë¡œì íŠ¸ ì¼ì •ì´ ì§€ì—°ë˜ê³  ìˆì–´ìš”"
       â†“
Create Embedding (Vercel AI SDK)
  embed({ model: openai.textEmbeddingModel('text-embedding-3-small'), value: text })
  â†’ [0.234, -0.567, ...]
       â†“
pgvector Similarity Search (Supabase Client)
  SELECT * FROM search_similar_patterns(
    embedding,
    'ISTJ',
    'CS',
    '1w2',
    'superior'
  )
  â†’ [íŒ¨í„´1, íŒ¨í„´2, íŒ¨í„´3]
       â†“
Build System Prompt
  - í˜ë¥´ì†Œë‚˜ íŠ¹ì„± (MBTI+DiSC+ì• ë‹ˆì–´ê·¸ë¨)
  - ê´€ê³„ ê°€ì´ë“œ (ìƒê¸‰ì â†’ ì •ì¤‘í•¨, ì¡´ëŒ“ë§)
  - ìœ ì‚¬ íŒ¨í„´ ì˜ˆì‹œ
       â†“
Streaming Response (Vercel AI SDK)
  streamText({ model: openai('gpt-4o'), messages, ... })
  GPT-4o ì‹¤ì‹œê°„ ì‘ë‹µ
       â†“
UI Update (useChat Hook)
  - í† í° ë‹¨ìœ„ ìŠ¤íŠ¸ë¦¬ë°
  - ìë™ ë©”ì‹œì§€ ì €ì¥
  - ì¬ì‹œë„ ë° ì—ëŸ¬ ì²˜ë¦¬ ë‚´ì¥
```

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ ì„ íƒ ê·¼ê±°

### Frontend

#### Next.js 16
**ì„ íƒ ì´ìœ **:
- **Turbopack**: ê°œë°œ ì„œë²„ ì†ë„ 10ë°° í–¥ìƒ
- **PPR (Partial Prerendering)**: Static + Dynamic ìµœì  ì¡°í•©
- **Server Components**: ë²ˆë“¤ í¬ê¸° ê°ì†Œ
- **Vercel ìµœì í™”**: ë°°í¬ ìë™í™”

**ëŒ€ì•ˆ ëŒ€ë¹„ ì¥ì **:
- Remix: ë” ê°„ë‹¨í•œ ë°ì´í„° ë¡œë”©ì´ì§€ë§Œ, Vercel í†µí•© ì•½í•¨
- SvelteKit: ë²ˆë“¤ í¬ê¸°ëŠ” ì‘ì§€ë§Œ, ìƒíƒœê³„ ì‘ìŒ

#### shadcn/ui
**ì„ íƒ ì´ìœ **:
- **ì½”ë“œ ì†Œìœ ê¶Œ**: npm íŒ¨í‚¤ì§€ ì˜ì¡´ ìµœì†Œí™”
- **Radix UI ê¸°ë°˜**: ì ‘ê·¼ì„± ì™„ë²½
- **Tailwind ì™„ì „ ì œì–´**: ì»¤ìŠ¤í„°ë§ˆì´ì§• ììœ ë„
- **v0.dev í†µí•©**: AI ê¸°ë°˜ ì»´í¬ë„ŒíŠ¸ ìƒì„±

**ëŒ€ì•ˆ ëŒ€ë¹„ ì¥ì **:
- Material UI: ë¬´ê²ê³  ì»¤ìŠ¤í„°ë§ˆì´ì§• ì–´ë ¤ì›€
- Chakra UI: ë²ˆë“¤ í¬ê¸° í¬ê³  Tailwindì™€ ì¶©ëŒ
- Ant Design: ë””ìì¸ ììœ ë„ ë‚®ìŒ

#### Vercel AI SDK (ì „ì²´ AI í†µí•©)
**ì„ íƒ ì´ìœ **:
- **useChat í›…**: ìŠ¤íŠ¸ë¦¬ë° ëŒ€í™” 3ì¤„ êµ¬í˜„
- **embed/embedMany**: ë²¡í„° ìƒì„± ê°„í¸í™”
- **OpenAI ë„¤ì´í‹°ë¸Œ í†µí•©**: ì¶”ê°€ ì„¤ì • ë¶ˆí•„ìš”
- **Edge Runtime ìµœì í™”**: ê¸€ë¡œë²Œ ì €ì§€ì—°
- **í†µí•© API**: UI + Embedding + LLM ëª¨ë‘ í•˜ë‚˜ì˜ SDKë¡œ ì²˜ë¦¬

**âš ï¸ ì¤‘ìš”**:
- ë³„ë„ì˜ OpenAI SDK ì„¤ì¹˜ ë¶ˆí•„ìš”
- `@ai-sdk/openai` ì–´ëŒ‘í„°ê°€ OpenAI API í˜¸ì¶œ ì²˜ë¦¬
- ì„¤ì¹˜: `npm install ai @ai-sdk/openai`

### Backend

#### Supabase
**ì„ íƒ ì´ìœ **:
- **ì˜¬ì¸ì› ë°±ì—”ë“œ**: PostgreSQL + Auth + Realtime + Storage
- **pgvector ë„¤ì´í‹°ë¸Œ**: ë³„ë„ ì„¤ì • ì—†ì´ ë²¡í„° ê²€ìƒ‰
- **RLS (Row Level Security)**: ë³´ì•ˆ ìë™í™”
- **ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘**: API ìë™ ìƒì„±

**ëŒ€ì•ˆ ëŒ€ë¹„ ì¥ì **:
- Firebase: NoSQLë¡œ ë³µì¡í•œ ì¿¼ë¦¬ ì–´ë ¤ì›€
- MongoDB: ë²¡í„° ê²€ìƒ‰ ì¶”ê°€ ì„¤ì • í•„ìš”
- Prisma + PostgreSQL: Auth, Realtime ë³„ë„ êµ¬ì¶•

#### pgvector
**ì„ íƒ ì´ìœ **:
- **ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê²€ìƒ‰**: ëŒ€í™” íŒ¨í„´ ë§¤ì¹­ì— ìµœì 
- **PostgreSQL ë„¤ì´í‹°ë¸Œ**: ë³„ë„ ì„œë¹„ìŠ¤ ë¶ˆí•„ìš”
- **ivfflat ì¸ë±ìŠ¤**: ëŒ€ê·œëª¨ ë°ì´í„° ë¹ ë¥¸ ê²€ìƒ‰

**ëŒ€ì•ˆ ëŒ€ë¹„ ì¥ì **:
- Pinecone: ë¹„ìš© ë†’ê³  ë³„ë„ ê´€ë¦¬ í•„ìš”
- Weaviate: ë³µì¡í•œ ì„¤ì •
- Elasticsearch: ë²¡í„° ê²€ìƒ‰ ìµœì í™” ë¶€ì¡±

## ğŸ—„ ë°ì´í„°ë² ì´ìŠ¤ ERD

```
profiles (users)
    â†“ 1:N
persona_profiles (AI í˜ë¥´ì†Œë‚˜)
    â”œâ”€ profile_embedding vector(1536)
    â””â”€ traits JSONB
    â†“ 1:N
chat_sessions (ëŒ€í™” ì„¸ì…˜)
    â”œâ”€ relationship_type VARCHAR(20)
    â””â”€ session_metadata JSONB
    â†“ 1:N
chat_messages (ë©”ì‹œì§€)
    â”œâ”€ role VARCHAR(20)
    â””â”€ content TEXT

conversation_patterns (ì „ì—­ ì§€ì‹ ë² ì´ìŠ¤)
    â”œâ”€ pattern_embedding vector(1536)
    â”œâ”€ mbti + disc + enneagram
    â””â”€ example_responses JSONB
```

### í…Œì´ë¸” ì—­í• 

**profiles**:
- Supabase Auth users ì—°ë™
- ì‚¬ìš©ì ë©”íƒ€ë°ì´í„° ì €ì¥

**persona_profiles**:
- ì‚¬ìš©ìê°€ ìƒì„±í•œ AI í˜ë¥´ì†Œë‚˜ ì •ì˜
- 3ê°€ì§€ ì‹¬ë¦¬ í”„ë¡œí•„ (MBTI + DiSC + ì• ë‹ˆì–´ê·¸ë¨) í•„ìˆ˜
- ë²¡í„° ì„ë² ë”©ìœ¼ë¡œ ìœ ì‚¬ í˜ë¥´ì†Œë‚˜ ê²€ìƒ‰ ê°€ëŠ¥

**conversation_patterns**:
- ì „ì—­ ëŒ€í™” íŒ¨í„´ ì§€ì‹ ë² ì´ìŠ¤
- ê° ì‹¬ë¦¬ ì¡°í•© + ê´€ê³„ë³„ íŒ¨í„´ ì €ì¥
- ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ìœ ì‚¬ íŒ¨í„´ ë§¤ì¹­

**chat_sessions**:
- ëŒ€í™” ì„¸ì…˜ ë‹¨ìœ„ ì¶”ì 
- ê´€ê³„ ì„¤ì • (ìƒê¸‰ì/ë™ë£Œ/í•˜ê¸‰ì) ì €ì¥

**chat_messages**:
- ë©”ì‹œì§€ ë ˆë²¨ ì €ì¥
- í† í° ì‚¬ìš©ëŸ‰, ì‘ë‹µ ì‹œê°„ ì¶”ì 

## ğŸ” ë³´ì•ˆ ì•„í‚¤í…ì²˜

### Row Level Security (RLS)

```sql
-- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼
CREATE POLICY "Own data only" ON persona_profiles
  FOR ALL USING (auth.uid() = user_id);

-- conversation_patternsëŠ” ì „ì²´ ê³µê°œ (ì½ê¸°ë§Œ)
CREATE POLICY "Public read" ON conversation_patterns
  FOR SELECT TO authenticated USING (true);
```

**ì¥ì **:
- APIì—ì„œ ë³„ë„ ê¶Œí•œ ì²´í¬ ë¶ˆí•„ìš”
- SQL ë ˆë²¨ì—ì„œ ìë™ í•„í„°ë§
- ì‹¤ìˆ˜ë¡œ ë‹¤ë¥¸ ì‚¬ìš©ì ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€

### í™˜ê²½ ë³€ìˆ˜ ë¶„ë¦¬

```bash
# í´ë¼ì´ì–¸íŠ¸ ë…¸ì¶œ ê°€ëŠ¥
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY

# ì„œë²„ ì „ìš© (ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€)
SUPABASE_SERVICE_ROLE_KEY
OPENAI_API_KEY
```

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### Edge Runtime
```typescript
// src/app/api/chat/route.ts
export const runtime = 'edge'
```
- ê¸€ë¡œë²Œ CDN ë°°í¬
- Cold Start ìµœì†Œí™”
- ì§€ì—° ì‹œê°„ 50% ê°ì†Œ

### ë²¡í„° ì¸ë±ìŠ¤
```sql
CREATE INDEX idx_persona_embedding ON persona_profiles 
  USING ivfflat (profile_embedding vector_cosine_ops) 
  WITH (lists = 100);
```
- ì„ í˜• ê²€ìƒ‰ ëŒ€ë¹„ 10ë°° ë¹ ë¦„
- 10,000 rowsê¹Œì§€ ìµœì í™”

### Streaming Response
- ì²« í† í°ê¹Œì§€ < 500ms
- ì‚¬ìš©ì ì²´ê° ëŒ€ê¸° ì‹œê°„ ê°ì†Œ
- ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ì„± í–¥ìƒ

## ğŸ”„ í™•ì¥ ì „ëµ

### Phase 1 â†’ Phase 2
- ë‹¨ì¼ í˜ë¥´ì†Œë‚˜ â†’ ë‹¤ì¤‘ í˜ë¥´ì†Œë‚˜
- ê¸°ë³¸ íŒ¨í„´ â†’ í•™ìŠµëœ íŒ¨í„´

### ìˆ˜í‰ í™•ì¥
- Supabase: ìë™ ìŠ¤ì¼€ì¼ë§
- Vercel: Serverless ìë™ í™•ì¥
- pgvector: Sharding ê°€ëŠ¥

### ê¸°ëŠ¥ í™•ì¥
- ìŒì„± ëŒ€í™” (Whisper API)
- ê°ì • ë¶„ì„ (GPT-4o vision)
- ë‹¤êµ­ì–´ ì§€ì› (i18n)

---

**ë‹¤ìŒ**: `docs/requirements.md`ì—ì„œ êµ¬ì²´ì ì¸ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ í™•ì¸